#!/bin/bash
#===============================================================================
# FILE:         functions.sh
#
# USAGE:        Include in ohter scripts, e.g. source functions.sh
#
# DESCRIPTION:  Basic functions used by other scripts.
#               Contains only function definitions - they are not executed.
#===============================================================================

set -o nounset errexit

#===============================================================================
# Basic functions
#===============================================================================

# Requires:
#   LOG_FILE
#   LOG_PREFIX
log()
{
    # Use msg with prefix to distinguish logs generated by setup scripts
    local msg="$LOG_PREFIX$@"

    # Write message to screen and log file
    (echo "$msg" 2>&1) | tee -a $LOG_FILE
    return ${PIPESTATUS[0]}
}

# Requires:
#   LOG_FILE
#   CMD_PREFIX
cmd()
{
    # Record command to be executed to the log file
    echo "$CMD_PREFIX$@" >> $LOG_FILE

    # Execute command
    # Redirect stdout and stderr to screen and log file
    (eval "$@" 2>&1) | tee -a $LOG_FILE
    return ${PIPESTATUS[0]}
}

uncommentVar()
{
	local var="$1"
	local file="$2"

    cmd "sed -i \"s|^#\(${var}.*\)$|\1|\" ${file}"
    return $?
}

commentVar()
{
	local var="$1"
	local file="$2"

    cmd "sed -i \"s|^\(${var}.*\)$|#\1|\" ${file}"
    return $?
}

